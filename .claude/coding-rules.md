# Coding Rules

## RESTful API設計原則

- **リソース指向のURL設計:** URLはリソース（名詞）を表し、動詞は使用しない
  - Good: `GET /users`, `POST /users`, `GET /users/{id}`
  - Bad: `GET /getUsers`, `POST /createUser`
- **適切なHTTPメソッドの使用:**
  - `GET` - リソースの取得（冪等）
  - `POST` - リソースの作成
  - `PUT` - リソースの完全な更新（冪等）
  - `PATCH` - リソースの部分更新
  - `DELETE` - リソースの削除（冪等）
- **適切なHTTPステータスコード:** 200系（成功）、400系（クライアントエラー）、500系（サーバーエラー）を正しく使い分ける
- **一貫したレスポンス形式:** JSON構造を統一し、エラーレスポンスも一貫性を保つ
- **Laravelでの実装:** Resourceコントローラー（`php artisan make:controller --resource`）を活用

## MVC原則

- **Model:** ビジネスロジックとデータアクセスのみを担当
  - Eloquentリレーションシップを活用
  - 複雑なクエリはスコープやリポジトリパターンで分離
- **View:** 表示ロジックのみを担当
  - ロジックはBladeディレクティブやReactコンポーネントに限定
  - データの整形はPresenter/Resourceで行う
- **Controller:** リクエストの受け取りとレスポンスの返却のみ
  - バリデーションはFormRequestに委譲
  - ビジネスロジックはService/Actionクラスに委譲
  - Controllerは薄く保つ（Fat Model, Skinny Controller）

## 単一責任の原則（SRP）

- **1メソッド = 1責務:** メソッドは1つのことだけを行う
  - 「〇〇して、△△する」というメソッド名は責務の分離が必要なサイン
- **1クラス = 1変更理由:** クラスが変更される理由は1つだけであるべき
- **責務が増えたら分離:**
  - 大きなServiceクラス → 複数のActionクラスに分割
  - 複雑なControllerメソッド → Service/Actionに委譲
- **Laravelでの実践:**
  - FormRequest: バリデーションの責務
  - Policy: 認可の責務
  - Observer: モデルイベント処理の責務
  - Job: 非同期処理の責務

## シンプルなコードを書く

- **複雑さを見つけたら立ち止まる:** 「もっとシンプルに書けないか？」を常に問う
- **早期リターン:** ネストを減らすためにガード節を使用
  ```php
  // Bad
  if ($condition) {
      // 長い処理
  }

  // Good
  if (!$condition) {
      return;
  }
  // 処理
  ```
- **意味のある変数名・メソッド名:** コメントなしで意図が伝わる命名
- **マジックナンバー/文字列を避ける:** 定数やEnumを使用
- **コレクション操作を活用:** `foreach`より`map`, `filter`, `reduce`
- **条件分岐の簡略化:** 複雑な条件はメソッドに抽出して命名

## ベストプラクティス

- **DRY（Don't Repeat Yourself）:** 同じコードを2回以上書かない。ただし、過度な抽象化は避ける
- **YAGNI（You Aren't Gonna Need It）:** 今必要なものだけを実装する。将来のための過度な設計は避ける
- **KISS（Keep It Simple, Stupid）:** 最もシンプルな解決策を選ぶ
- **依存性の注入:** コンストラクタインジェクションを使用し、テスタビリティを確保
- **型安全性:** PHPでは型宣言、TypeScriptでは厳密な型定義を使用
- **エラーハンドリング:** 例外は適切にキャッチし、ユーザーに意味のあるメッセージを返す
- **ログ記録:** 重要な操作とエラーは適切にログに記録

## コードレビューチェックリスト

新しいコードを書いたら以下を確認：

1. [ ] RESTful原則に従っているか？
2. [ ] Controllerは薄いか？（ロジックはService/Actionに移動したか？）
3. [ ] 1つのメソッドは1つの責務のみか？
4. [ ] もっとシンプルに書ける方法はないか？
5. [ ] テストは書いたか？
6. [ ] `vendor/bin/pint --dirty`を実行したか？
